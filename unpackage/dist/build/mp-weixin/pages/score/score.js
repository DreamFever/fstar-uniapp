(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/score/score"],{"00e0":function(e,t,n){"use strict";n.r(t);var a=n("9e10"),r=n.n(a);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t["default"]=r.a},"20ca":function(e,t,n){"use strict";var a=n("3b5a"),r=n.n(a);r.a},"293b":function(e,t,n){"use strict";n.r(t);var a=n("4a8b"),r=n("00e0");for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);n("20ca");var s,c=n("f0c5"),i=Object(c["a"])(r["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],s);t["default"]=i.exports},"3b5a":function(e,t,n){},"4a8b":function(e,t,n){"use strict";var a={uniDataCheckbox:function(){return Promise.all([n.e("common/vendor"),n.e("components/uni-data-checkbox/uni-data-checkbox")]).then(n.bind(null,"63f5"))},uniPopup:function(){return Promise.all([n.e("common/vendor"),n.e("components/uni-popup/uni-popup")]).then(n.bind(null,"6b2c"))},wLoading:function(){return n.e("components/w-loading/w-loading").then(n.bind(null,"15c8"))}},r=function(){var e=this,t=e.$createElement;e._self._c},o=[];n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a}))},"9e10":function(e,t,n){"use strict";(function(e){function n(e,t){return o(e)||r(e,t)||l(e,t)||a()}function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],a=!0,r=!1,o=void 0;try{for(var s,c=e[Symbol.iterator]();!(a=(s=c.next()).done);a=!0)if(n.push(s.value),t&&n.length===t)break}catch(i){r=!0,o=i}finally{try{a||null==c["return"]||c["return"]()}finally{if(r)throw o}}return n}}function o(e){if(Array.isArray(e))return e}function s(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=l(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r,o=!0,s=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==a.return||a.return()}finally{if(s)throw r}}}}function c(e){return f(e)||u(e)||l(e)||i()}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e,t){if(e){if("string"===typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function u(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function f(e){if(Array.isArray(e))return d(e)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var h=getApp(),p={data:function(){return{scoreData:h.globalData.score,detail:{},semester:h.globalData.settings.scoreQuerySemester,years:h.globalData.course.years,calculateMode:"必修绩点",selected:[],selectedIndex:[],calculateFunc:{0:function(e){return-1===e.name.indexOf("体育")&&"必修"===e.courseProperty},1:function(e){return-1===e.name.indexOf("体育")&&"必修"===e.courseProperty||"任选"===e.courseProperty},2:function(e){return!0},3:function(e){return!0}},manual:!1,funcIndex:0,range:[{value:0,text:"必修"},{value:1,text:"必修任选"},{value:2,text:"全部"},{value:3,text:"自选"}],message:"发生了错误"}},computed:{semesterList:function(){return["全部"].concat(c(this.years))},gpaInfo:function(){return console.log("calculate gpa"),3==this.funcIndex?this.calculateGpa(this.calculateFunc[this.funcIndex],this.selected):this.calculateGpa(this.calculateFunc[this.funcIndex],this.scoreData)}},onShow:function(){this.years=h.globalData.course.years},methods:{handleQuery:function(t){var n=this;this.$refs.loading.open();var a=e.getStorageSync("login_key");if(!a)return this.message="请先在设置中验证账号",this.$refs.message.open(),void this.$refs.loading.close();a.xsfs=h.globalData.settings.maxScore?"MAX":"ALL",a.kksj="全部"==this.semester?"":this.semester,console.log(a);var r=h.globalData.host;h.globalData.settings.useVPN?r+="/vpn":r+="/just",r+="/score",h.globalData.settings.defaultScoreQuery||(r+="2");try{e.request({method:"GET",url:r,data:a,success:function(t){console.log(t);var a,r=t.data;200===r.code?(n.scoreData.length=0,(a=n.scoreData).push.apply(a,c(r.data.reverse())),e.setStorage({key:"score_key",data:n.scoreData}),n.calculateGpa((function(e){return!0}),n.scoreData)):(n.message=r.message,n.$refs.message.open());n.$refs.loading.close()},fail:function(e){n.$refs.loading.close(),n.message="发生了错误",n.$refs.message.open()}})}catch(t){console.log(t),this.$refs.loading.close(),this.message="发生了错误",this.$refs.message.open()}},handleDetailTap:function(e){console.log("tap"),3!==this.funcIndex&&(this.detail=e,this.$refs.popup.open())},closeDialog:function(){this.$refs.popup.close()},bindPickerChange:function(t){var n=t.detail.value,a=this.semesterList[n];console.log(a),this.semester=a,h.globalData.settings.scoreQuerySemester=a,e.setStorage({key:"settings_key",data:h.globalData.settings})},calculateGpa:function(e,t){var a,r=new Map,o=s(t);try{for(o.s();!(a=o.n()).done;){var c=a.value;r.has(c.semester)||r.set(c.semester,[]),r.get(c.semester).push(c)}}catch(F){o.e(F)}finally{o.f()}var i=[];h.globalData.settings.maxScore&&h.globalData.settings.defaultScoreQuery?i.push("最好成绩(绩点可作参考)"):i.push("非最好成绩(绩点不作参考)"),i.push(this.calculateMode);var l,u=0,f=0,d=0,p=0,g=0,m=0,b=0,y=s(r);try{for(y.s();!(l=y.n()).done;){var v=n(l.value,2),x=v[0],S=v[1],D=0,k=0,w=0;S.forEach((function(t){if(e(t)){"优"===t.score&&(D+=4.5*parseFloat(t.credit)),"良"===t.score&&(D+=3.5*parseFloat(t.credit)),"中"!==t.score&&"合格"!==t.score||(D+=2.5*parseFloat(t.credit)),"及格"===t.score&&(D+=1.5*parseFloat(t.credit)),"通过"===t.score&&(D+=2.5*parseFloat(t.credit));try{parseFloat(t.score)>=60&&(D+=parseFloat(t.credit)*(parseFloat(t.score)/10-5))}catch(n){console.log(n)}finally{k+=parseFloat(t.credit)}}})),f+=D,d+=k,r.has(x.substr(0,x.length-1)+"2")&&(b++,g+=D,m+=k),w=D/k,i.push("".concat(x,"学期平均绩点：").concat(w.toFixed(3))),2===b&&(b=0,p=g/m,i.push("---".concat(x.substr(0,x.length-2),"学年平均绩点: ").concat(p.toFixed(3),"---")),g=0,m=0)}}catch(F){y.e(F)}finally{y.f()}return u=f/d,isNaN(u)&&(u=0),i.push("总平均绩点：".concat(u.toFixed(3))),console.log(i),i},modeChange:function(e){var t=e.detail.value;switch(t){case 0:this.calculateMode="必修绩点",this.manual=!1;break;case 1:this.calculateMode="必修任选绩点",this.manual=!1;break;case 2:this.calculateMode="全部绩点",this.manual=!1;break;case 3:this.calculateMode="自选绩点",this.manual=!0;break}},checkboxGroupChange:function(e){var t=[];console.log(e.detail);var n,a=s(e.detail.value);try{for(a.s();!(n=a.n()).done;){var r=n.value;t.push(this.scoreData[r])}}catch(o){a.e(o)}finally{a.f()}this.selected=t}}};t.default=p}).call(this,n("543d")["default"])},e629:function(e,t,n){"use strict";(function(e){n("c7c7");a(n("66fd"));var t=a(n("293b"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])}},[["e629","common/runtime","common/vendor"]]]);