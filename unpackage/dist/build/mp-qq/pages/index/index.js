(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{1272:function(e,t,n){"use strict";var r={wLoading:function(){return n.e("components/w-loading/w-loading").then(n.bind(null,"15c8"))},uniPopup:function(){return Promise.all([n.e("common/vendor"),n.e("components/uni-popup/uni-popup")]).then(n.bind(null,"6b2c"))}},o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.__map(8,(function(t,n){var r=e.__get_orig(t),o=0==t?e.dateData[7*(e.currentWeek-1)].getMonth():null,a=0!=t?(new Date).setHours(0,0,0,0):null,s=0!=t?e.dateData[t-1+7*(e.currentWeek-1)].setHours(0,0,0,0):null,i=0!=t?e.getDayOfWeek(t):null,u=0!=t?e.dateData[t-1+7*(e.currentWeek-1)].getDate():null;return{$orig:r,g0:o,g1:a,g2:s,m0:i,g3:u}}))),r=e.__map(8,(function(t,n){var r=e.__get_orig(t),o=0!==t?e.colorList():null;return{$orig:r,m1:o}})),o=e.getRawWeek(e.detailCourse.week);e.$mp.data=Object.assign({},{$root:{l0:n,l1:r,m2:o}})},a=[];n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return r}))},"1e9c":function(e,t,n){"use strict";(function(e){n("c7c7");r(n("66fd"));var t=r(n("a3a0"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("a821")["createPage"])},"3e00":function(e,t,n){"use strict";(function(e){function n(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=r(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a,s=!0,i=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==o.return||o.return()}finally{if(i)throw a}}}}function r(e,t){if(e){if("string"===typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=getApp(),s={data:function(){return{title:"繁星课程表",currentSemester:"",weekIndex:0,moreCourse:[],detailCourse:{week:[]},beginTime:(new Date).getTime(),course:a.globalData.course,message:"发生了错误",colorIndex:0,idColorMap:new Map}},onLoad:function(){console.log("课表页 onLoad")},onShow:function(){console.log("课表页 onShow"),this.colorIndex=0;var e=a.globalData;this.course=e.course,this.currentSemester=e.settings.currentSemester,this.beginTime=e.settings.beginTime;var t=this.beginTime,n=(new Date).getTime(),r=n-t,o=parseInt(r/1e3/60/60/24/7);o>=this.week.length&&(o=this.week.length-1),o<0&&(o=0),this.weekIndex=o},computed:{currentSemesterIndex:function(){return this.course.years.indexOf(this.currentSemester)},week:function(){return Array.from(new Array(this.course.week),(function(e,t){return t+1}))},currentWeek:function(){return this.week[this.weekIndex]},remark:function(){return this.course.remark?this.course.remark:"备注："},dateData:function(){new Date(this.beginTime);for(var e=864e5,t=[],n=0;n<210;++n)t.push(new Date(n*e+this.beginTime));return t},tableData:function(){var e,t=this,r={},o=this.course.course.filter((function(e){return-1!==e.week.indexOf(t.currentWeek)})),a=n(o);try{for(a.s();!(e=a.n()).done;){var s=e.value;r[s.row]||(r[s.row]=[]),r[s.row][s.column]||(r[s.row][s.column]=[]),this.idColorMap.has(s.id)||(this.idColorMap.set(s.id,this.colorIndex),this.colorIndex=++this.colorIndex%this.colorList().length),s.colorIndex=this.idColorMap.get(s.id),r[s.row][s.column].push(s)}}catch(i){a.e(i)}finally{a.f()}return r}},methods:{open:function(){this.$refs.loading.open()},getRawWeek:function(e){for(var t=new Set(e),n=-1,r=[],o=e[0];o<=e[e.length-1]+1;++o)t.has(o)&&-1==n&&(n=o),t.has(o)||-1==n||(n==o-1?r.push("".concat(n)):r.push("".concat(n,"-").concat(o-1)),n=-1);return r.join(",")+"(周)"},closeDialog:function(){this.$refs.popup.close()},handleSemesterChange:function(t){var n=this;this.currentSemester=this.course.years[t.detail.value];try{this.$refs.loading.open();var r=a.globalData.host;a.globalData.settings.useVPN?r+="/vpn":r+="/just",r+="/course";var o=e.getStorageSync("login_key");if(!o)return this.message="请先在设置中验证账号",this.$refs.message.open(),void this.$refs.loading.close();o.kksj=this.currentSemester,e.request({url:r,method:"GET",data:o,success:function(t){var r=t.data;200!==r.code?(console.log(r.message),n.message=r.message,n.$refs.message.open()):(console.log("success"),e.setStorage({key:"course_key",data:r.data}),a.globalData.course=r.data,a.globalData.settings.currentSemester=o.kksj,a.globalData.settings.scoreQuerySemester=o.kksj,e.setStorage({key:"settings_key",data:a.globalData.settings}),n.course=a.globalData.course),n.$refs.loading.close()}})}catch(t){console.log(t),this.$refs.loading.close(),this.message="发生了错误",this.$refs.message.open()}},onRefresh:function(){console.log("refresh"),console.log(this.currentSemester),this.handleSemesterChange({detail:{value:this.course.years.indexOf(this.currentSemester)}})},handleDetailTap:function(e,t){var n=this.tableData[2*(e+1)-1][t];n.length>1?(this.moreCourse=n,this.$refs.more.open()):this.openDetail(n[0])},weekChange:function(e){this.weekIndex=e.detail.value},openDetail:function(e){console.log(e),this.detailCourse=e,this.$refs.detail.open()},closeDetail:function(){this.$refs.detail.close()},colorList:function(){return["#00CCFF","#8D4BBB","#33CC99","#EF7A82","#789262","#66CCCC","#9999FF","#6699CC","#88ADA6","#9D2933","#758a99","#549688","#815476","#4b5cc4","#DB5A6B","#FF00CC","#C83C23","#44CEF6"]},getDayOfWeek:function(e){switch(e){case 1:return"一";case 2:return"二";case 3:return"三";case 4:return"四";case 5:return"五";case 6:return"六";case 7:return"日"}}}};t.default=s}).call(this,n("a821")["default"])},a3a0:function(e,t,n){"use strict";n.r(t);var r=n("1272"),o=n("c96e");for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("ca61");var s,i=n("f0c5"),u=Object(i["a"])(o["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],s);t["default"]=u.exports},c586:function(e,t,n){},c96e:function(e,t,n){"use strict";n.r(t);var r=n("3e00"),o=n.n(r);for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=o.a},ca61:function(e,t,n){"use strict";var r=n("c586"),o=n.n(r);o.a}},[["1e9c","common/runtime","common/vendor"]]]);